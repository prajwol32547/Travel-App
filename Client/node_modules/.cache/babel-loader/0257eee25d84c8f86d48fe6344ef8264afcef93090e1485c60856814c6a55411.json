{"ast":null,"code":"var _s = $RefreshSig$();\nimport Axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport { refresh } from \"./Refresh\";\nconst intercept = Axios.create({\n  withCredentials: true\n});\n_s(intercept.interceptors.request.use(_s(async function (config) {\n  _s();\n  const authToken = localStorage.getItem(\"jwtToken\");\n  console.log(`Bearer ${authToken}`);\n  if (authToken) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${authToken}`\n    };\n  } else {\n    useNavigate()(\"/login\");\n  }\n  return config; // Return the modified config for the request\n}, \"7z+bV9xHBQ1A1bt6m/1oQLk0tZA=\", false, function () {\n  return [useNavigate];\n}), function (error) {\n  return Promise.reject(error);\n}), \"7z+bV9xHBQ1A1bt6m/1oQLk0tZA=\", false, function () {\n  return [useNavigate];\n});\nconst responseIntercept = intercept.interceptors.response.use(response => response, async error => {\n  var _error$response;\n  const prevRequest = error === null || error === void 0 ? void 0 : error.config;\n  if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 403 && !(prevRequest !== null && prevRequest !== void 0 && prevRequest.sent)) {\n    try {\n      // await refresh();\n      // Retry the original request after successful refresh\n      return Axios(prevRequest);\n    } catch (refreshError) {\n      console.error(\"Refresh failed\", refreshError);\n      // Redirect to the login page\n\n      if (Promise.reject(refreshError)) {\n        // window.location.replace(\"http://localhost:3000/login\");\n      }\n    }\n  }\n  return Promise.reject(error);\n});\n\n// Correct the usage of intercept.post and intercept.get\nexport const postRequest = async (api, data) => {\n  try {\n    const res = await intercept.post(api, data);\n    return res.data;\n  } catch (error) {\n    console.error(\"Post request failed\", error);\n    throw error;\n  }\n};\nexport const getRequest = async api => {\n  try {\n    const res = await intercept.get(api);\n    return res.data;\n  } catch (error) {\n    console.error(\"Get request failed\", error);\n    throw error;\n  }\n};","map":{"version":3,"names":["Axios","useNavigate","refresh","intercept","create","withCredentials","interceptors","request","use","config","authToken","localStorage","getItem","console","log","headers","Authorization","error","Promise","reject","responseIntercept","response","prevRequest","status","sent","refreshError","postRequest","api","data","res","post","getRequest","get"],"sources":["/home/prajwol/Travel-App/travelapp/Client/src/Atom/AxiosReq.js"],"sourcesContent":["import Axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport { refresh } from \"./Refresh\";\n\nconst intercept = Axios.create({\n\twithCredentials: true,\n});\n\nintercept.interceptors.request.use(\n\tasync function (config) {\n\t\tconst authToken = localStorage.getItem(\"jwtToken\");\n\t\tconsole.log(`Bearer ${authToken}`);\n\n\t\tif (authToken) {\n\t\t\tconfig.headers = {\n\t\t\t\t...config.headers,\n\t\t\t\tAuthorization: `Bearer ${authToken}`,\n\t\t\t};\n\t\t} else {\n\t\t\tuseNavigate()(\"/login\");\n\t\t}\n\n\t\treturn config; // Return the modified config for the request\n\t},\n\tfunction (error) {\n\t\treturn Promise.reject(error);\n\t}\n);\n\nconst responseIntercept = intercept.interceptors.response.use(\n\t(response) => response,\n\tasync (error) => {\n\t\tconst prevRequest = error?.config;\n\t\tif (error?.response?.status === 403 && !prevRequest?.sent) {\n\t\t\ttry {\n\t\t\t\t// await refresh();\n\t\t\t\t// Retry the original request after successful refresh\n\t\t\t\treturn Axios(prevRequest);\n\t\t\t} catch (refreshError) {\n\t\t\t\tconsole.error(\"Refresh failed\", refreshError);\n\t\t\t\t// Redirect to the login page\n\n\t\t\t\tif (Promise.reject(refreshError)) {\n\t\t\t\t\t// window.location.replace(\"http://localhost:3000/login\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn Promise.reject(error);\n\t}\n);\n\n// Correct the usage of intercept.post and intercept.get\nexport const postRequest = async (api, data) => {\n\ttry {\n\t\tconst res = await intercept.post(api, data);\n\t\treturn res.data;\n\t} catch (error) {\n\t\tconsole.error(\"Post request failed\", error);\n\t\tthrow error;\n\t}\n};\n\nexport const getRequest = async (api) => {\n\ttry {\n\t\tconst res = await intercept.get(api);\n\t\treturn res.data;\n\t} catch (error) {\n\t\tconsole.error(\"Get request failed\", error);\n\t\tthrow error;\n\t}\n};\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,OAAO,QAAQ,WAAW;AAEnC,MAAMC,SAAS,GAAGH,KAAK,CAACI,MAAM,CAAC;EAC9BC,eAAe,EAAE;AAClB,CAAC,CAAC;AAEF,GAAAF,SAAS,CAACG,YAAY,CAACC,OAAO,CAACC,GAAG,IACjC,gBAAgBC,MAAM,EAAE;EAAA;EACvB,MAAMC,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EAClDC,OAAO,CAACC,GAAG,CAAE,UAASJ,SAAU,EAAC,CAAC;EAElC,IAAIA,SAAS,EAAE;IACdD,MAAM,CAACM,OAAO,GAAG;MAChB,GAAGN,MAAM,CAACM,OAAO;MACjBC,aAAa,EAAG,UAASN,SAAU;IACpC,CAAC;EACF,CAAC,MAAM;IACNT,WAAW,EAAE,CAAC,QAAQ,CAAC;EACxB;EAEA,OAAOQ,MAAM,CAAC,CAAC;AAChB,CAAC;EAAA,QAJCR,WAAW;AAAA,IAKb,UAAUgB,KAAK,EAAE;EAChB,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC7B,CAAC,CACD;EAAA,QAREhB,WAAW;AAAA;AAUd,MAAMmB,iBAAiB,GAAGjB,SAAS,CAACG,YAAY,CAACe,QAAQ,CAACb,GAAG,CAC3Da,QAAQ,IAAKA,QAAQ,EACtB,MAAOJ,KAAK,IAAK;EAAA;EAChB,MAAMK,WAAW,GAAGL,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAER,MAAM;EACjC,IAAI,CAAAQ,KAAK,aAALA,KAAK,0CAALA,KAAK,CAAEI,QAAQ,oDAAf,gBAAiBE,MAAM,MAAK,GAAG,IAAI,EAACD,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAEE,IAAI,GAAE;IAC1D,IAAI;MACH;MACA;MACA,OAAOxB,KAAK,CAACsB,WAAW,CAAC;IAC1B,CAAC,CAAC,OAAOG,YAAY,EAAE;MACtBZ,OAAO,CAACI,KAAK,CAAC,gBAAgB,EAAEQ,YAAY,CAAC;MAC7C;;MAEA,IAAIP,OAAO,CAACC,MAAM,CAACM,YAAY,CAAC,EAAE;QACjC;MAAA;IAEF;EACD;EACA,OAAOP,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC7B,CAAC,CACD;;AAED;AACA,OAAO,MAAMS,WAAW,GAAG,OAAOC,GAAG,EAAEC,IAAI,KAAK;EAC/C,IAAI;IACH,MAAMC,GAAG,GAAG,MAAM1B,SAAS,CAAC2B,IAAI,CAACH,GAAG,EAAEC,IAAI,CAAC;IAC3C,OAAOC,GAAG,CAACD,IAAI;EAChB,CAAC,CAAC,OAAOX,KAAK,EAAE;IACfJ,OAAO,CAACI,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;IAC3C,MAAMA,KAAK;EACZ;AACD,CAAC;AAED,OAAO,MAAMc,UAAU,GAAG,MAAOJ,GAAG,IAAK;EACxC,IAAI;IACH,MAAME,GAAG,GAAG,MAAM1B,SAAS,CAAC6B,GAAG,CAACL,GAAG,CAAC;IACpC,OAAOE,GAAG,CAACD,IAAI;EAChB,CAAC,CAAC,OAAOX,KAAK,EAAE;IACfJ,OAAO,CAACI,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;IAC1C,MAAMA,KAAK;EACZ;AACD,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}